class CreateAccessTables < ActiveRecord::Migration
  def change
    create_table :access_accounts do |t|
      t.string :account_name
      t.string :primary_email
      t.string :salta
      t.string :saltb
      t.integer :iterations
      t.string :passhash
      t.integer :permissions_override_add
      t.integer :permissions_override_remove
      t.integer :registered_ip
      t.text :registered_user_agent
      t.integer :must_validate

      t.timestamps null: false
    end
    add_index 'access_accounts', ['account_name'], name: 'access_account_name_unique', unique: true
    add_index 'access_accounts', ['primary_email'], name: 'access_account_email_unique', unique: true
    create_table :access_groups do |t|
      t.string :group_name
      t.integer :permissions

      t.timestamps null: false
    end
    add_index 'access_groups', ['group_name'], name: 'access_group_name_unique', unique: true
    create_table :access_group_memberships do |t|
      t.integer :user_id
      t.integer :group_id

      t.timestamps null: false
    end
    add_index 'access_group_memberships', ['user_id'], name: 'access_group_member_to_user'
    add_index 'access_group_memberships', ['group_id'], name: 'access_group_member_to_group'
    add_index 'access_group_memberships', ['user_id','group_id'], name: 'access_group_member_unique', unique: true
    create_table :access_auto_logins do |t|
      t.integer :user_id
      t.string :public_key
      t.string :private_key

      t.timestamps null: false
    end
    add_index 'access_auto_logins', ['user_id'], name: 'access_autologin_to_user'
    add_index 'access_auto_logins', ['public_key'], name: 'access_autologin_public_index'
    add_index 'access_auto_logins', ['private_key'], name: 'access_autologin_private_index'
    add_index 'access_auto_logins', ['user_id','public_key'], name: 'access_autologin_unique', unique: true
    create_table :access_login_attempts do |t|
      t.string :username
      t.text :passhash
      t.integer :login_id

      t.timestamps null: false
    end
    create_table :access_logins do |t|
      t.integer :user_id
      t.integer :ip
      t.text :user_agent
      t.integer :auto_login_id

      t.timestamps null: false
    end
    add_index 'access_logins', ['user_id'], name: 'access_login_to_user'
    add_index 'access_logins', ['auto_login_id'], name: 'access_login_to_autologin'
    create_table :access_forced_group_ips do |t|
      t.integer :group_id
      t.integer :ip_low
      t.integer :ip_high
      t.text :notes

      t.timestamps null: false
    end
    create_table :access_banned_emails do |t|
      t.string :regex
      t.text :notes

      t.timestamps null: false
    end
  end
end
